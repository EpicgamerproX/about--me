<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ice & Ember: Ultimate Reality</title>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@300;500&display=swap');

        :root {
            --bg-dark: #020202;
            --accent: #ffae00;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-dark);
            color: white;
            font-family: 'Montserrat', sans-serif;
            overflow: hidden; 
            height: 100vh;
            width: 100vw;
        }

        /* --- UI LAYER --- */
        nav {
            position: fixed;
            top: 30px; left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            gap: 15px;
            background: rgba(30,30,30,0.6);
            padding: 10px 30px;
            border-radius: 50px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(12px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }

        .nav-btn {
            background: none;
            border: none;
            color: rgba(255,255,255,0.6);
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: 0.3s;
        }
        .nav-btn.active { color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.5); }

        .section {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0; pointer-events: none;
            transition: opacity 0.8s ease;
        }
        .section.active { opacity: 1; pointer-events: all; }

        /* --- PORTFOLIO (Ice Slab) --- */
        #portfolio-section {
            perspective: 1200px;
            background: radial-gradient(circle at center, #111 0%, #000 100%);
            display: flex; justify-content: center; align-items: center;
        }
        
        .ice-slab {
            width: 65vw; height: 65vh;
            background: linear-gradient(135deg, rgba(200, 240, 255, 0.05), rgba(200, 240, 255, 0.02));
            border: 1px solid rgba(255,255,255,0.1);
            border-top: 1px solid rgba(255,255,255,0.3);
            border-radius: 8px;
            transform: rotateX(35deg);
            transform-style: preserve-3d;
            box-shadow: 0 30px 60px rgba(0,0,0,0.8), inset 0 0 50px rgba(100,200,255,0.05);
            position: relative;
        }

        .content-layer {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%) translateZ(60px);
            text-align: center; pointer-events: none;
        }
        
        h1 { font-family: 'Playfair Display'; font-size: 5rem; color: transparent; background: linear-gradient(to bottom, #fff, #88ccee); -webkit-background-clip: text; margin: 0; }
        p.sub { letter-spacing: 4px; color: #88ccee; font-size: 0.9rem; margin-top: 10px; text-transform: uppercase; }

        /* --- PROJECTS (WebGL) --- */
        #projects-section { background: #000; }
        #webgl-canvas { position: absolute; width: 100%; height: 100%; z-index: 1; }
        
        .project-card {
            position: absolute; top: 50%; transform: translateY(-50%);
            width: 280px; padding: 30px;
            background: rgba(10,10,10,0.8);
            border-left: 2px solid var(--accent);
            backdrop-filter: blur(10px);
            z-index: 2; color: #ddd;
            transition: all 0.5s ease;
        }
        .card-left { left: 10%; transform: translateX(-50px) translateY(-50%); opacity: 0; }
        .card-right { right: 10%; transform: translateX(50px) translateY(-50%); opacity: 0; text-align: right; border-left: none; border-right: 2px solid var(--accent); }
        
        .section.active .card-left, .section.active .card-right { transform: translateX(0) translateY(-50%); opacity: 1; }
        h2 { color: var(--accent); font-family: 'Playfair Display'; margin-bottom: 10px; }
        p { font-size: 0.85rem; line-height: 1.6; color: #aaa; }

    </style>
</head>
<body>

    <nav>
        <button class="nav-btn active" onclick="switchTab('portfolio')">PORTFOLIO</button>
        <button class="nav-btn" onclick="switchTab('projects')">PROJECTS</button>
    </nav>

    <section id="portfolio-section" class="section active">
        <div class="ice-slab" id="ice-slab">
            <canvas id="frost-canvas" style="position: absolute; top: 0; left: 0; width: 100%; height: 100%; opacity: 0.5; mix-blend-mode: overlay;"></canvas>
            <div class="content-layer">
                <h1>JOHN DOE</h1>
                <p class="sub">Digital Craftsman</p>
            </div>
        </div>
    </section>

    <section id="projects-section" class="section">
        <canvas id="webgl-canvas"></canvas>
        <div class="project-card card-left">
            <h2>Algorithmic Trading</h2>
            <p>Real-time Python dashboard visualization using WebSockets.</p>
        </div>
        <div class="project-card card-right">
            <h2>Neural Imaging</h2>
            <p>AI-powered medical diagnostics interface with 99% accuracy.</p>
        </div>
    </section>

    <script type="module">
        import * as THREE from 'three';
        import { RoomEnvironment } from 'three/addons/environments/RoomEnvironment.js';

        // --- GLOBAL STATE ---
        let currentTab = 'portfolio';
        let mouseX = 0, mouseY = 0;

        // --- 1. PORTFOLIO INTERACTIVITY ---
        const slab = document.getElementById('ice-slab');
        document.addEventListener('mousemove', (e) => {
            mouseX = (e.clientX - window.innerWidth/2) * 0.0005;
            mouseY = (e.clientY - window.innerHeight/2) * 0.0005;

            if(currentTab === 'portfolio') {
                slab.style.transform = `rotateX(${35 - mouseY * 20}deg) rotateY(${mouseX * 20}deg)`;
            }
        });

        // Frost Effect
        const frostC = document.getElementById('frost-canvas');
        const fCtx = frostC.getContext('2d');
        function resizeFrost() { frostC.width = frostC.offsetWidth; frostC.height = frostC.offsetHeight; }
        window.addEventListener('resize', resizeFrost);
        setTimeout(resizeFrost, 0);

        let trails = [];
        frostC.addEventListener('mousemove', (e) => {
            const r = frostC.getBoundingClientRect();
            trails.push({x: e.clientX - r.left, y: e.clientY - r.top, a: 1});
        });
        function animateFrost() {
            fCtx.clearRect(0,0,frostC.width, frostC.height);
            trails.forEach((t, i) => {
                t.a -= 0.01;
                fCtx.beginPath(); fCtx.arc(t.x, t.y, 20, 0, 7);
                fCtx.fillStyle = `rgba(255,255,255,${t.a * 0.2})`; fCtx.fill();
            });
            trails = trails.filter(t => t.a > 0);
            requestAnimationFrame(animateFrost);
        }
        animateFrost();


        // --- 2. THE REALISTIC GLASS ENGINE ---
        const canvas = document.querySelector('#webgl-canvas');
        const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: false }); // Alpha false for better refraction
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.2;
        renderer.shadowMap.enabled = true;
        renderer.shadowMap.type = THREE.SoftShadowMap;

        const scene = new THREE.Scene();
        // Dark background so glass has contrast
        scene.background = new THREE.Color(0x050505);

        // ENVIRONMENT (Crucial for Glass)
        const pmremGenerator = new THREE.PMREMGenerator(renderer);
        scene.environment = pmremGenerator.fromScene(new RoomEnvironment(), 0.04).texture;

        const camera = new THREE.PerspectiveCamera(40, window.innerWidth/window.innerHeight, 0.1, 100);
        camera.position.set(0, 5, 12);

        // MATERIALS
        // 1. Crystal Glass
        const glassMat = new THREE.MeshPhysicalMaterial({
            color: 0xffffff,
            metalness: 0, roughness: 0,
            transmission: 1, thickness: 1.5,
            ior: 1.5, envMapIntensity: 1.5,
            clearcoat: 1, transparent: true
        });

        // 2. Amber Whiskey (Transparent)
        const liquidMat = new THREE.MeshPhysicalMaterial({
            color: 0xffae00,
            metalness: 0, roughness: 0.1,
            transmission: 0.6, // Allow light through
            thickness: 2,
            ior: 1.4, // Alcohol index
            attenuationColor: new THREE.Color(0x8a4b08),
            attenuationDistance: 5,
            transparent: true, opacity: 0.9
        });

        // 3. Frosty Ice (Visible!)
        const iceMat = new THREE.MeshPhysicalMaterial({
            color: 0xffffff,
            metalness: 0.1, roughness: 0.7, // High roughness = Frosty
            transmission: 0.8, thickness: 2,
            ior: 1.31,
            clearcoat: 0.5
        });

        // OBJECTS
        const glassGroup = new THREE.Group();
        scene.add(glassGroup);

        // Glass Shape
        const points = [];
        for (let i = 0; i < 12; i++) {
            points.push(new THREE.Vector2(Math.sin(i * 0.2) * 1.5 + 0.1, (i - 5) * 0.6));
        }
        const latheGeo = new THREE.LatheGeometry([
            new THREE.Vector2(0, 0), new THREE.Vector2(1.5, 0), 
            new THREE.Vector2(1.8, 5), new THREE.Vector2(1.6, 5), 
            new THREE.Vector2(1.3, 0.4), new THREE.Vector2(0, 0.4)
        ], 64);
        const cup = new THREE.Mesh(latheGeo, glassMat);
        cup.position.y = -2;
        cup.castShadow = true; cup.receiveShadow = true;
        glassGroup.add(cup);

        // Liquid Shape
        const liqGeo = new THREE.CylinderGeometry(1.5, 1.25, 2.5, 32);
        const liquid = new THREE.Mesh(liqGeo, liquidMat);
        liquid.position.y = -1;
        glassGroup.add(liquid);

        // Bubbles (Particle System)
        const bubbleGeo = new THREE.SphereGeometry(0.05, 8, 8);
        const bubbles = [];
        for(let i=0; i<40; i++) {
            const b = new THREE.Mesh(bubbleGeo, new THREE.MeshBasicMaterial({color: 0xffaa00, opacity: 0.6, transparent: true}));
            b.position.set((Math.random()-0.5)*2, -2 + Math.random()*2, (Math.random()-0.5)*2);
            b.userData = { speed: 0.02 + Math.random()*0.03, limit: 0 }; // Float up
            glassGroup.add(b);
            bubbles.push(b);
        }

        // Ice Cubes
        const iceGeo = new THREE.BoxGeometry(1.1, 1.1, 1.1);
        const c1 = new THREE.Mesh(iceGeo, iceMat); c1.position.set(0.3, -1, 0.3); c1.rotation.set(1,1,0); glassGroup.add(c1);
        const c2 = new THREE.Mesh(iceGeo, iceMat); c2.position.set(-0.4, 0, -0.2); c2.rotation.set(2,0.5,1); glassGroup.add(c2);

        // Background Particles (To give glass something to refract)
        const starGeo = new THREE.BufferGeometry();
        const starCount = 500;
        const starPos = new Float32Array(starCount * 3);
        for(let i=0; i<starCount*3; i++) starPos[i] = (Math.random() - 0.5) * 30;
        starGeo.setAttribute('position', new THREE.BufferAttribute(starPos, 3));
        const stars = new THREE.Points(starGeo, new THREE.PointsMaterial({color: 0x555555, size: 0.1}));
        scene.add(stars);

        // Lighting
        const spot = new THREE.SpotLight(0xffaa00, 100);
        spot.position.set(5, 10, 5); spot.angle = 0.5; spot.penumbra = 1; spot.castShadow = true;
        scene.add(spot);
        const blueRim = new THREE.PointLight(0x0044ff, 20);
        blueRim.position.set(-5, 2, -5); scene.add(blueRim);


        // ANIMATION LOOP
        function animate() {
            requestAnimationFrame(animate);
            if(currentTab !== 'projects') return;

            // Rotate Glass based on mouse
            glassGroup.rotation.x += (mouseY * 0.5 - glassGroup.rotation.x) * 0.1;
            glassGroup.rotation.y += (mouseX * 0.5 - glassGroup.rotation.y) * 0.1;

            // Wobbly Liquid (Vertex Physics)
            const time = Date.now() * 0.003;
            const positions = liqGeo.attributes.position;
            for(let i=0; i<positions.count; i++) {
                if(positions.getY(i) > 1.2) { // Top surface only
                    const x = positions.getX(i);
                    const z = positions.getZ(i);
                    // Wave math
                    const wave = Math.sin(x * 2 + time) * 0.1 + Math.cos(z * 1.5 + time) * 0.1;
                    // Tilt influence
                    const tilt = (x * -glassGroup.rotation.z + z * glassGroup.rotation.x) * 0.5;
                    
                    positions.setY(i, 1.25 + wave + tilt);
                }
            }
            positions.needsUpdate = true;

            // Animate Bubbles
            bubbles.forEach(b => {
                b.position.y += b.userData.speed;
                if(b.position.y > 0.5) b.position.y = -2; // Reset to bottom
            });

            // Float Ice
            c2.position.y = 0 + Math.sin(time*0.5)*0.05;
            c2.rotation.x += 0.002;

            renderer.render(scene, camera);
        }
        animate();

        // Switch Logic
        window.switchTab = (t) => {
            currentTab = t;
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(t+'-section').classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth/window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>

