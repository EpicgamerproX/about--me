<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Achyut | Portfolio</title>
    <style>
        /* --- 1. RESET & CORE --- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            cursor: none; 
            -webkit-user-select: none;
            user-select: none; 
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }

        body::-webkit-scrollbar { display: none; }
        body {
            -ms-overflow-style: none;
            scrollbar-width: none;
            font-family: 'Helvetica Neue', Helvetica, Arial, sans-serif;
            background-color: #050505;
            color: #fff;
            overflow-x: hidden;
            width: 100%;
            height: 100%;
            overscroll-behavior: none;
            line-height: 1.618; 
        }

        /* --- 2. GRAIN TEXTURE --- */
        .noise-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 99999;
            opacity: 0.06;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='1'/%3E%3C/svg%3E");
        }

        /* --- 3. THE BLOB --- */
        #cursor-blob {
            position: fixed;
            top: 0;
            left: 0;
            width: 162px; 
            height: 162px;
            background-color: #fff;
            mix-blend-mode: difference;
            border-radius: 50%;
            pointer-events: none;
            z-index: 10000;
            transform: translate3d(-50%, -50%, 0);
            
            transition: 
                width 0.38s cubic-bezier(0.2, 0.8, 0.2, 1),
                height 0.38s cubic-bezier(0.2, 0.8, 0.2, 1),
                border-radius 0.38s cubic-bezier(0.2, 0.8, 0.2, 1),
                background-color 0.2s ease,
                border 0.2s ease;
            
            will-change: transform, width, height;
        }

        #cursor-blob.expanded {
            width: 250vmax !important; 
            height: 250vmax !important;
            border-radius: 0 !important; 
            transition: width 1s ease-in-out, height 1s ease-in-out, border-radius 1s ease-in-out;
        }
        #cursor-blob.expanded.blackout { background-color: #000; mix-blend-mode: normal; }
        #cursor-blob.breaking { background-color: #fff !important; mix-blend-mode: difference !important; transition: all 0.1s ease !important; animation: shatterEffect 0.38s forwards; }

        #cursor-blob.liquid-active {
            mix-blend-mode: normal !important;
            background-color: transparent !important; 
            border: 2px solid rgba(0,0,0,0.8) !important; 
            width: 80px !important; 
            height: 80px !important;
        }

        @keyframes shatterEffect {
            0% { transform: translate(-50%, -50%) scale(1); }
            20% { transform: translate(-52%, -48%) scale(1.02); } 
            40% { transform: translate(-48%, -52%) scale(1.02); } 
            60% { transform: translate(-50%, -50%) scale(1.05); } 
            100% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
        }

        /* --- 4. LAYERS & SPACERS --- */
        .layer {
            position: sticky;
            top: 0;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            padding: 0 10vw;
            background-color: #050505;
            border-top: 1px solid rgba(255,255,255,0.08);
            overflow: hidden;
            box-shadow: 0 -50px 100px rgba(0,0,0,0.8);
            z-index: 1; 
        }
        
        #layer-1 { z-index: 10; position: sticky; overflow: hidden; } 
        #layer-2 { z-index: 20; background-color: #080808; }
        #layer-3 { z-index: 30; background-color: #000000; }
        #layer-skills { z-index: 40; background-color: #050505; padding: 0; flex-direction: row; }
        #layer-5 { z-index: 50; background-color: #020202; }
        
        #layer-6 { 
            z-index: 60; 
            background-color: #111;
            padding: 0; 
        }

        .spacer { width: 100%; height: 38.2vh; background: transparent; pointer-events: none; }

        /* --- 5. THE FLIP GLASS GRID --- */
        .glass-grid {
            position: absolute; top: 0; right: 0; 
            width: 38.2vw; height: 100%; display: flex;
            z-index: 0; pointer-events: none; perspective: 1000px;
        }
        .glass-slice { flex: 1; height: 100%; position: relative; }
        .slice-inner {
            position: relative; width: 100%; height: 100%; text-align: center;
            transition: transform 0.6s cubic-bezier(0.4, 0.2, 0.2, 1);
            transform-style: preserve-3d; border-right: 1px solid rgba(255, 255, 255, 0.05);
        }
        .slice-front, .slice-back {
            position: absolute; width: 100%; height: 100%; backface-visibility: hidden; -webkit-backface-visibility: hidden;
        }
        .slice-front { background-color: transparent; }
        .slice-back {
            background-color: #ffffff; color: #000000; transform: rotateY(180deg);
            display: flex; align-items: center; justify-content: center;
            writing-mode: vertical-rl; text-orientation: mixed;
            font-family: monospace; font-weight: bold; font-size: 1rem; letter-spacing: 2px;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
        }
        .glass-slice:last-child .slice-inner { border-right: none; }
        .glass-slice.flipped .slice-inner { transform: rotateY(-180deg); }


        /* --- 6. FLUID FILL EFFECT --- */
        #fluid-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: #fff; z-index: 9990; 
            pointer-events: none; 
            clip-path: circle(0% at var(--fill-x, 90%) var(--fill-y, 50%));
            transition: clip-path 1.2s cubic-bezier(0.65, 0, 0.35, 1);
            will-change: clip-path; 
        }

        #fluid-overlay.filling { pointer-events: auto; clip-path: circle(150% at var(--fill-x, 90%) var(--fill-y, 50%)); }
        #fluid-overlay.draining { pointer-events: none; clip-path: circle(0% at 50% 100%); }

        #project-showcase {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9995;
            display: flex; align-items: center; justify-content: center; gap: 20px; padding: 5vw;
            opacity: 0; pointer-events: none;
            transition: opacity 0.5s ease 0.5s; 
            overscroll-behavior: contain; overflow-y: auto; -webkit-overflow-scrolling: touch;
        }

        #project-showcase.visible { opacity: 1; pointer-events: auto; }

        .project-card {
            flex: 1; height: 60vh; border: 2px solid #000; color: #000; padding: 30px;
            display: flex; flex-direction: column; justify-content: space-between;
            background: rgba(255,255,255,0.5); transform: translateY(50px);
            transition: transform 0.8s ease; will-change: transform;
        }
        
        #project-showcase.visible .project-card { transform: translateY(0); }
        .project-card h3 { font-size: 2rem; font-weight: 800; letter-spacing: -1px; margin-bottom: 10px; color: #000;}
        .project-card p { font-size: 1rem; color: #333; line-height: 1.5; font-family: monospace; }
        .card-num { font-size: 4rem; font-weight: 900; opacity: 0.1; align-self: flex-end; }
        
        .btn-drain {
            position: fixed; bottom: 40px; right: 40px; width: 80px; height: 80px;
            border-radius: 50%; border: 2px solid #000; background: rgba(255, 255, 255, 0.9);
            color: #000; display: flex; align-items: center; justify-content: center;
            cursor: none; z-index: 10000; transition: all 0.3s ease; pointer-events: auto;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
        }
        .btn-drain svg { width: 24px; height: 24px; fill: #000; transition: transform 0.3s ease; }
        .btn-drain.hovered-state { background: #000; transform: scale(1.1); }
        .btn-drain.hovered-state svg { fill: #fff; transform: rotate(90deg); }


        /* --- 7. HIDDEN FINAL CONTENT --- */
        #final-layer {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 10001;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            opacity: 0; visibility: hidden; pointer-events: none;
            transition: opacity 0.62s ease, visibility 0s linear 0.62s; text-align: center;
        }
        #final-layer.active { opacity: 1; visibility: visible; pointer-events: auto; transition: opacity 0.62s ease; }
        #final-layer h1 { color: #fff; font-family: monospace; font-size: 4vw; margin-bottom: 2.618rem; text-shadow: 0 0 10px rgba(255,255,255,0.5); }
        #final-layer p { color: #888; font-family: monospace; font-size: 1.2rem; margin-bottom: 0.618rem; }
        #break-trigger { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; cursor: pointer; }
        .action-hint { margin-top: 4.236rem; font-size: 0.8rem; text-transform: uppercase; letter-spacing: 2px; color: #444; animation: pulse 1.618s infinite; font-family: monospace; }
        @keyframes pulse { 0%,100%{opacity:0.3} 50%{opacity:1} }

        /* --- 8. UI ELEMENTS --- */
        h1 { font-size: 7vw; line-height: 1.1; font-weight: 800; letter-spacing: -3px; margin-bottom: 2.618rem; color: #fff; position: relative; z-index: 10; pointer-events: auto; }
        h2 { font-size: 0.9rem; font-weight: 600; text-transform: uppercase; letter-spacing: 3px; color: #666; margin-bottom: 1.618rem; z-index: 10; }
        p { font-size: 1.5rem; max-width: 600px; line-height: 1.618; color: #bbb; margin-bottom: 1.618rem; z-index: 10; }
        .mobile-hint { display: none; font-size: 0.75rem; color: #444; margin-top: 1.618rem; text-transform: uppercase; letter-spacing: 1px; }
        .btn-container { margin-top: 30px; display: flex; flex-wrap: wrap; gap: 15px; }
        .btn { display: inline-block; padding: 12px 30px; border: 1px solid rgba(255,255,255,0.3); border-radius: 30px; color: white; text-decoration: none; text-transform: uppercase; letter-spacing: 1px; font-size: 0.75rem; font-weight: 700; position: relative; z-index: 20; background: transparent; transition: opacity 0.3s; pointer-events: auto; }
        .btn.hovered-state { border-color: transparent; }
        .btn.fill-trigger { position: absolute; right: 10vw; top: 50%; transform: translateY(-50%); border-color: #fff; background: rgba(255,255,255,0.05); z-index: 50; }

        /* --- 9. SIDEBAR --- */
        .skill-left { width: 100%; height: 100%; display: flex; flex-direction: column; justify-content: center; padding-left: 10vw; transition: opacity 0.38s; }
        .pull-indicator { position: absolute; right: 20px; top: 50%; transform: translateY(-50%); z-index: 40; display: flex; flex-direction: column; align-items: center; opacity: 0.6; animation: pulseLeft 2s infinite; }
        .arrow-icon { width: 0; height: 0; border-top: 8px solid transparent; border-bottom: 8px solid transparent; border-right: 12px solid #fff; margin-bottom: 8px; }
        .pull-text { writing-mode: vertical-rl; text-orientation: mixed; font-size: 0.6rem; text-transform: uppercase; letter-spacing: 2px; }
        @keyframes pulseLeft { 0%, 100% { transform: translateY(-50%) translateX(0); opacity: 0.5; } 50% { transform: translateY(-50%) translateX(-10px); opacity: 1; } }
        .skill-sidebar { position: absolute; right: 0; top: 0; width: 38.2%; min-width: 300px; height: 100vh; background-color: rgba(10, 10, 10, 0.9); backdrop-filter: blur(15px); border-left: 1px solid rgba(255,255,255,0.1); padding: 61.8px 38.2px; overflow-y: auto; z-index: 50; transform: translateX(100%); will-change: transform; box-shadow: -20px 0 50px rgba(0,0,0,0.8); }
        .skill-category { margin-bottom: 40px; }
        .skill-category h3 { font-size: 0.75rem; text-transform: uppercase; color: #555; margin-bottom: 1.618rem; letter-spacing: 2px; border-bottom: 1px solid #333; padding-bottom: 5px; }
        .skill-grid { display: flex; flex-wrap: wrap; gap: 8px; }
        .skill-tag { display: inline-block; padding: 8px 14px; border: 1px solid rgba(255,255,255,0.15); border-radius: 20px; font-size: 0.7rem; color: #ddd; background: transparent; font-weight: 600; position: relative; z-index: 20; white-space: nowrap; }
        .skill-tag.hovered-state { border-color: transparent; color: #fff; }
        .ripple { position: fixed; border-radius: 50%; transform: translate(-50%, -50%); pointer-events: none; mix-blend-mode: difference; border: 1px solid rgba(255, 255, 255, 0.4); animation: rippleAnim 1.618s ease-out forwards; z-index: 9999; will-change: transform, opacity; }
        @keyframes rippleAnim { 0% { width: 0; height: 0; opacity: 0.6; } 100% { width: 100vmax; height: 100vmax; opacity: 0; } }

        /* --- 10. DYNAMIC SHUTTER STYLES --- */
        #shutter-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 5;
            display: flex; flex-direction: column;
            pointer-events: none; 
        }
        .shutter-row {
            flex: 1;
            width: 100%;
            position: relative;
            overflow: hidden;
            outline: 1px solid transparent; 
        }
        
        .shutter-left, .shutter-right {
            position: absolute;
            top: 0; bottom: 0; left: 0;
            width: 100%;
            background-color: #050505;
            will-change: transform;
            
            /* Text Stying */
            display: flex;
            align-items: center;
            font-family: monospace;
            font-size: 0.7rem; 
            color: rgba(255,255,255,0.25); 
            white-space: nowrap;
            overflow: hidden;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        .shutter-left {
            transform: translateX(-100%); 
            border-right: 1px solid rgba(255,255,255,0.1);
            justify-content: flex-end; 
            padding-right: 15px;
        }
        .shutter-right {
            transform: translateX(0); 
            justify-content: flex-start; 
            padding-left: 15px;
        }

        /* HIDDEN CONTENT BEHIND SHUTTERS */
        .reveal-content {
            width: 100%; height: 100%;
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            text-align: center;
            z-index: 1; 
        }
        .reveal-title { font-size: 8vw; font-weight: 900; color: #fff; line-height: 0.9; text-transform: uppercase; }
        .reveal-sub { font-size: 1.5rem; color: #888; margin-top: 20px; font-family: monospace; }

        @media (max-width: 768px) { 
            h1 { font-size: 3.5rem; line-height: 1; margin-bottom: 1.618rem; } 
            p { font-size: 1.1rem; max-width: 100%; }
            .layer { padding: 0 8vw; }
            .mobile-hint { display: block; }
            .skill-sidebar { width: 85%; min-width: unset; padding: 80px 30px 40px 30px; } 
            #cursor-blob { width: 100px; height: 100px; }
            .pull-indicator { right: 10px; }
            .pull-text { display: none; }
            .spacer { height: 25vh; }
            #final-layer h1 { font-size: 8vw; }
            .glass-grid { width: 25vw; }
            #project-showcase { flex-direction: column; justify-content: flex-start; padding-top: 60px; padding-bottom: 120px; }
            .project-card { height: auto; min-height: 250px; margin-bottom: 20px; flex: none; }
            .btn.fill-trigger { position: relative; right: auto; top: auto; transform: none; margin-top: 20px; }
            .btn-drain { width: 60px; height: 60px; bottom: 30px; right: 30px; }
            .shutter-left, .shutter-right { font-size: 0.6rem; }
        }
    </style>
</head>
<body>

    <div class="noise-overlay"></div>
    <div id="cursor-blob"></div>

    <div id="fluid-overlay"></div>
    <div id="project-showcase">
        <div class="project-card">
            <div class="card-num">01</div>
            <h3>E-Commerce</h3>
            <p>A headless Shopify build with Next.js and WebGL product configurator.</p>
        </div>
        <div class="project-card">
            <div class="card-num">02</div>
            <h3>Finance App</h3>
            <p>Real-time stock dashboard using WebSockets and Python backend.</p>
        </div>
        <div class="project-card">
            <div class="card-num">03</div>
            <h3>AI Tool</h3>
            <p>Generative image processing tool wrapped in Electron for desktop.</p>
        </div>
        <button class="btn-drain magnetic-target" onclick="closeLiquid()">
            <svg viewBox="0 0 24 24">
                <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
            </svg>
        </button>
    </div>

    <div id="final-layer">
        <div id="break-trigger" onclick="breakLayer()"></div>
        <h1>TERMINAL<br>ACCESS.</h1>
        <p>Achyut | Full Stack Developer</p>
        <p>achyut@devmail.com</p>
        <p>+91 0000 00000</p>
        <div class="action-hint">[ CLICK TO DISCONNECT ]</div>
    </div>

    <main>
        <section class="layer" id="layer-1">
            <div class="glass-grid">
                <div class="glass-slice"><div class="slice-inner"><div class="slice-front"></div><div class="slice-back">WEB</div></div></div>
                <div class="glass-slice"><div class="slice-inner"><div class="slice-front"></div><div class="slice-back">APP</div></div></div>
                <div class="glass-slice"><div class="slice-inner"><div class="slice-front"></div><div class="slice-back">UX</div></div></div>
                <div class="glass-slice"><div class="slice-inner"><div class="slice-front"></div><div class="slice-back">DEV</div></div></div>
            </div>
            <h2>Portfolio</h2>
            <h1>HI, I'M<br>ACHYUT.</h1>
            <p>Full Stack Developer.</p>
            <div class="mobile-hint">Drag Blob to Interact</div>
        </section>
        <div class="spacer"></div>

        <section class="layer" id="layer-2">
            <h2>About</h2>
            <h1>CODE &<br>DESIGN.</h1>
            <p>Passionate about building accessible, pixel-perfect interfaces that scale.</p>
            <div class="btn-container">
                <a href="#" class="btn magnetic">Read Bio</a>
            </div>
        </section>
        <div class="spacer"></div>

        <section class="layer" id="layer-3">
            <h2>Work</h2>
            <h1>FEATURED<br>PROJECTS.</h1>
            <p>Backend systems & fluid frontend interactions.</p>
            <div class="btn-container" style="position: relative;">
                 <a href="https://github.com/EpicgamerproX" target="_blank" class="btn magnetic">GitHub</a>
                 <button class="btn magnetic fill-trigger" onclick="openLiquid(this)">FILL</button>
            </div>
        </section>
        <div class="spacer"></div>

        <section class="layer" id="layer-skills">
            <div class="pull-indicator">
                <div class="arrow-icon"></div>
                <span class="pull-text">PULL OPEN</span>
            </div>
            <div class="skill-left">
                <h2>Capabilities</h2>
                <h1>TECHNICAL<br>ARSENAL.</h1>
                <p>Drag the blob to the right edge to reveal.</p>
            </div>
            <aside class="skill-sidebar" id="skillSidebar">
                 <div class="skill-category">
                    <h3>Frontend</h3>
                    <div class="skill-grid">
                        <div class="skill-tag magnetic">React</div>
                        <div class="skill-tag magnetic">Tailwind</div>
                        <div class="skill-tag magnetic">TypeScript</div>
                        <div class="skill-tag magnetic">HTML5</div>
                        <div class="skill-tag magnetic">CSS3</div>
                    </div>
                </div>
                 <div class="skill-category">
                    <h3>Backend</h3>
                    <div class="skill-grid">
                        <div class="skill-tag magnetic">Node</div>
                        <div class="skill-tag magnetic">Python</div>
                        <div class="skill-tag magnetic">PostgreSQL</div>
                    </div>
                     <h3>Others</h3>
                     <div class="skill-grid">
                         <div class="skill-tag magnetic">Machine Automation</div>
                         <div class="skill-tag magnetic">TensorFlow</div>
                         <div class="skill-tag magnetic">NumPy</div>
                         <div class="skill-tag magnetic">Pandas</div>
                         <div class="skill-tag magnetic">DBMS</div>
                     </div>
                </div>
            </aside>
        </section>
        <div class="spacer"></div>

        <section class="layer" id="layer-5">
            <h2>Contact</h2>
            <h1>LET'S<br>COLLABORATE.</h1>
            <div class="btn-container">
                <button class="btn magnetic" onclick="expandLayer()">UNLOCK TERMINAL</button>
            </div>
        </section>
        <div class="spacer"></div>

        <section class="layer" id="layer-6">
            <div id="shutter-container">
                </div>
            <div class="reveal-content">
                <div class="reveal-title">THANK<br>YOU.</div>
                <div class="reveal-sub">Designed & Built by Achyut</div>
            </div>
        </section>

        <div class="spacer" style="height: 20vh;"></div>
    </main>

    <script>
        const blob = document.getElementById('cursor-blob');
        const skillLayer = document.getElementById('layer-skills');
        const sidebar = document.getElementById('skillSidebar');
        const finalLayer = document.getElementById('final-layer');
        const glassGrid = document.querySelector('.glass-grid');
        const glassSlices = document.querySelectorAll('.glass-slice');
        
        const fluidOverlay = document.getElementById('fluid-overlay');
        const projectShowcase = document.getElementById('project-showcase');
        
        // REVEAL LAYER ELEMENTS
        const shutterContainer = document.getElementById('shutter-container');
        const revealLayer = document.getElementById('layer-6');
        const SHUTTER_COUNT = 12; 
        let shutterRows = [];

        // Quotes Array
        const quotes = [
            "TALK IS CHEAP. SHOW ME THE CODE.",
            "SIMPLICITY IS PREREQUISITE FOR RELIABILITY.",
            "CODE IS POETRY WRITTEN FOR MACHINES.",
            "FIRST, SOLVE THE PROBLEM. THEN, WRITE THE CODE.",
            "IF IT WORKS, DON'T TOUCH IT.",
            "EXPERIENCE IS THE NAME FOR MISTAKES.",
            "IT WORKS ON MY MACHINE.",
            "THERE'S NO PLACE LIKE 127.0.0.1",
            "JAVA IS TO JAVASCRIPT AS CAR IS TO CARPET.",
            "REAL PROGRAMMERS COUNT FROM 0.",
            "CTRL+C, CTRL+V IS A LIFESTYLE.",
            "A BUG IS JUST AN UNDOCUMENTED FEATURE."
        ];

        // INIT SHUTTERS
        for(let i=0; i<SHUTTER_COUNT; i++) {
            const row = document.createElement('div');
            row.className = 'shutter-row';
            const left = document.createElement('div');
            left.className = 'shutter-left';
            const right = document.createElement('div');
            right.className = 'shutter-right';
            
            // Inject Text
            const quoteText = quotes[i % quotes.length];
            left.innerText = quoteText;
            right.innerText = quoteText;

            row.appendChild(left);
            row.appendChild(right);
            shutterContainer.appendChild(row);
            shutterRows.push({
                el: row,
                leftPanel: left,
                rightPanel: right,
                y: 0,
                height: 0
            });
        }
        
        let blobX = window.innerWidth / 2;
        let blobY = window.innerHeight / 2;
        let velX = 0;
        let velY = 0;
        let mouseX = window.innerWidth / 2;
        let mouseY = window.innerHeight / 2;
        
        let isTouchDevice = false;
        window.addEventListener('touchstart', function() { isTouchDevice = true; }, {once:true});
        
        let isSecretMode = false;
        let isLiquidMode = false; 
        let currentHoveredBtn = null;

        // NEW: Click State
        let isClicking = false;
        // NEW: Animated base gap
        let baseGap = 240; 

        const FRICTION = 0.93; 
        const FOLLOW_SPEED = 0.08; 
        const MAGNET_RANGE = 80;

        // Event Listeners for Click/Touch Force
        window.addEventListener('mousedown', () => isClicking = true);
        window.addEventListener('mouseup', () => isClicking = false);
        window.addEventListener('touchstart', () => isClicking = true);
        window.addEventListener('touchend', () => isClicking = false);

        // Cache shutter metrics for performance
        function updateShutterMetrics() {
            if (!revealLayer) return;
            const rect = revealLayer.getBoundingClientRect();
            if (rect.bottom < 0 || rect.top > window.innerHeight) return;

            shutterRows.forEach((rowObj, i) => {
                const rowRect = rowObj.el.getBoundingClientRect();
                rowObj.y = rowRect.top + rowRect.height / 2;
                rowObj.height = rowRect.height;
            });
        }
        window.addEventListener('scroll', updateShutterMetrics, {passive: true});
        window.addEventListener('resize', updateShutterMetrics);

        window.openLiquid = function(btn) {
            if (isLiquidMode) return;
            isLiquidMode = true;
            document.body.style.overflow = 'hidden';

            const rect = btn.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            fluidOverlay.style.setProperty('--fill-x', centerX + 'px');
            fluidOverlay.style.setProperty('--fill-y', centerY + 'px');
            fluidOverlay.classList.remove('draining');
            fluidOverlay.classList.add('filling');
            projectShowcase.classList.add('visible');
            
            blob.classList.add('liquid-active');
        }

        window.closeLiquid = function() {
            isLiquidMode = false;
            document.body.style.overflow = '';
            
            projectShowcase.classList.remove('visible');
            fluidOverlay.classList.remove('filling');
            fluidOverlay.classList.add('draining');
            blob.classList.remove('liquid-active');
            
            setTimeout(() => {
                fluidOverlay.classList.remove('draining');
            }, 1200);
        }

        window.expandLayer = function() {
            if (isSecretMode) return;
            isSecretMode = true;
            blob.style.left = '50%';
            blob.style.top = '50%';
            blob.classList.add('expanded');
            setTimeout(() => {
                if(isSecretMode) {
                    blob.classList.add('blackout');
                    finalLayer.classList.add('active');
                }
            }, 800);
        };

        window.breakLayer = function() {
            if (!isSecretMode) return;
            finalLayer.classList.remove('active');
            blob.classList.remove('blackout');
            setTimeout(() => {
                blob.classList.remove('expanded');
                blob.classList.add('breaking');
            }, 50);
            setTimeout(() => {
                isSecretMode = false;
                blob.classList.remove('breaking');
                blobX = window.innerWidth / 2;
                blobY = window.innerHeight / 2;
                blob.style.left = blobX + 'px';
                blob.style.top = blobY + 'px';
            }, 380);
        };

        document.addEventListener('mousemove', (e) => {
            if(isSecretMode) return;
            mouseX = e.clientX;
            mouseY = e.clientY;
        });

        document.addEventListener('touchstart', (e) => {
            if(isSecretMode) return;
            isTouchDevice = true;
            const touchX = e.touches[0].clientX;
            const touchY = e.touches[0].clientY;
            if(!isLiquidMode) triggerRipple(touchX, touchY);
            mouseX = touchX;
            mouseY = touchY;
        }, { passive: false });

        document.addEventListener('touchmove', (e) => {
            if(isSecretMode) return;
            mouseX = e.touches[0].clientX;
            mouseY = e.touches[0].clientY;
        }, { passive: false });

        document.addEventListener('click', (e) => {
            if (isSecretMode) return; 
            if (currentHoveredBtn) {
                if (currentHoveredBtn.contains(e.target)) return;
                currentHoveredBtn.click();
            }
        });

        function triggerRipple(x, y) {
            const ripple = document.createElement('div');
            ripple.classList.add('ripple');
            ripple.style.left = x + 'px';
            ripple.style.top = y + 'px';
            document.body.appendChild(ripple);
            setTimeout(() => { ripple.remove(); }, 1000);
        }

        function animate() {
            if (isSecretMode) {
                currentHoveredBtn = null;
                requestAnimationFrame(animate);
                return;
            }

            const baseMagnetic = document.querySelectorAll('.magnetic');
            const liquidMagnetic = document.querySelectorAll('.magnetic-target');
            const targetList = isLiquidMode ? liquidMagnetic : baseMagnetic;

            const isMobile = window.innerWidth < 768;
            const baseSize = isMobile ? 100 : 162;

            let width = baseSize; 
            let height = baseSize;
            let borderRadius = '50%';
            
            // MOVEMENT
            if (isTouchDevice) {
                blobX += (mouseX - blobX) * 0.4;
                blobY += (mouseY - blobY) * 0.4;
                velX = 0; velY = 0; 
            } else {
                const dx = mouseX - blobX;
                const dy = mouseY - blobY;
                velX += (dx * FOLLOW_SPEED - velX) * 0.5;
                velY += (dy * FOLLOW_SPEED - velY) * 0.5;
                velX *= FRICTION;
                velY *= FRICTION;
                blobX += velX;
                blobY += velY;
            }

            // IDLE
            if (Math.abs(mouseX - blobX) < 1 && Math.abs(mouseY - blobY) < 1) {
                const time = Date.now() * 0.002;
                blobX += Math.sin(time) * 0.2;
                blobY += Math.cos(time * 1.5) * 0.2;
                const breathe = Math.sin(time * 2) * 5; 
                width += breathe;
                height += breathe;
            }

            // --- CURSOR-CENTRIC SHUTTER LOGIC ---
            const revealRect = revealLayer.getBoundingClientRect();
            if (revealRect.top < window.innerHeight && revealRect.bottom > 0) {
                const winW = window.innerWidth;
                if(shutterRows[0] && shutterRows[0].height === 0) updateShutterMetrics();

                // LERP BASE GAP FOR CLICK INTERACTION
                const targetBase = isClicking ? 800 : 240;
                baseGap += (targetBase - baseGap) * 0.1;

                shutterRows.forEach(rowObj => {
                    const distY = Math.abs(blobY - rowObj.y);
                    
                    let openFactor = Math.max(0, 1 - (distY / 400));
                    openFactor = openFactor * openFactor; 
                    
                    // Use Dynamic BaseGap
                    const gapSize = openFactor * baseGap; 

                    const leftShift = (blobX - gapSize) - winW;
                    const rightShift = blobX + gapSize;

                    rowObj.leftPanel.style.transform = `translate3d(${leftShift}px, 0, 0)`;
                    rowObj.rightPanel.style.transform = `translate3d(${rightShift}px, 0, 0)`;
                });
            }

            if (!isLiquidMode) {
                const gridRect = glassGrid.getBoundingClientRect();
                if (blobX >= gridRect.left && blobX <= gridRect.right) {
                    const relativeX = blobX - gridRect.left;
                    const totalSlices = glassSlices.length;
                    const sliceWidth = gridRect.width / totalSlices;
                    let activeSliceIndex = Math.floor(relativeX / sliceWidth);
                    if (activeSliceIndex < 0) activeSliceIndex = 0;
                    if (activeSliceIndex >= totalSlices) activeSliceIndex = totalSlices - 1;
                    glassSlices.forEach((slice, index) => {
                        if (index === activeSliceIndex) slice.classList.add('flipped');
                        else slice.classList.remove('flipped');
                    });
                } else {
                    glassSlices.forEach(slice => slice.classList.remove('flipped'));
                }
            }

            const skillsRect = skillLayer.getBoundingClientRect();
            const isLayerActive = Math.abs(skillsRect.top) < 50; 
            if (isLayerActive) { 
                const distFromRight = window.innerWidth - blobX;
                const pullStartZone = isMobile ? 200 : 400; 
                if (distFromRight < pullStartZone) {
                    const pullFactor = 1 - (distFromRight / pullStartZone);
                    const translateVal = 100 - (pullFactor * 100);
                    sidebar.style.transform = `translateX(${translateVal}%)`;
                    document.querySelector('.pull-indicator').style.opacity = 1 - pullFactor;
                } else {
                    sidebar.style.transform = `translateX(100%)`;
                    document.querySelector('.pull-indicator').style.opacity = 0.6;
                }
            } else {
                sidebar.style.transform = `translateX(100%)`;
            }

            let foundBtn = null; 
            targetList.forEach(btn => {
                const rect = btn.getBoundingClientRect();
                if (rect.bottom < 0 || rect.top > window.innerHeight) return;
                const btnCenterX = rect.left + rect.width / 2;
                const btnCenterY = rect.top + rect.height / 2;
                const dist = Math.hypot(blobX - btnCenterX, blobY - btnCenterY);
                if (dist < MAGNET_RANGE) {
                    const elAtPoint = document.elementFromPoint(btnCenterX, btnCenterY);
                    if (elAtPoint && (btn.contains(elAtPoint) || elAtPoint === btn)) {
                        if (!isTouchDevice) {
                            const pullStrength = 0.05;
                            velX += (btnCenterX - blobX) * pullStrength;
                            velY += (btnCenterY - blobY) * pullStrength;
                        }
                        if (dist < rect.width * 0.8) {
                            width = rect.width; height = rect.height; borderRadius = '20px';
                            btn.classList.add('hovered-state');
                            foundBtn = btn; 
                        } else { btn.classList.remove('hovered-state'); }
                    } else { btn.classList.remove('hovered-state'); }
                } else { btn.classList.remove('hovered-state'); }
            });
            currentHoveredBtn = foundBtn;

            if (blobX < 0) blobX = 0;
            if (blobX > window.innerWidth) blobX = window.innerWidth;

            blob.style.transform = `translate3d(${blobX}px, ${blobY}px, 0) translate(-50%, -50%)`;
            blob.style.width = width + 'px';
            blob.style.height = height + 'px';
            blob.style.borderRadius = borderRadius;

            requestAnimationFrame(animate);
        }

        animate();
    </script>
</body>
</html>
