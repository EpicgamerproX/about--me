<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ice & Ember Portfolio V2</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Montserrat:wght@300;400&display=swap');

        :root {
            --bg-dark: #050505;
            --ice-blue: #a5d8ff;
            --sand-color: #c2b280;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-dark);
            color: white;
            font-family: 'Montserrat', sans-serif;
            overflow: hidden; 
            height: 100vh;
            width: 100vw;
        }

        /* --- UI Overlay --- */
        nav {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            gap: 20px;
            background: rgba(255,255,255,0.05);
            padding: 10px 25px;
            border-radius: 50px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255,255,255,0.1);
        }

        .nav-btn {
            background: none;
            border: none;
            color: rgba(255,255,255,0.5);
            font-family: 'Playfair Display', serif;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-btn.active {
            color: #fff;
            text-shadow: 0 0 10px rgba(255,255,255,0.5);
        }

        /* --- Sections --- */
        .section-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0;
            pointer-events: none;
            transition: opacity 1s ease;
        }

        .section-container.active {
            opacity: 1;
            pointer-events: all;
        }

        /* --- PORTFOLIO (ICE) --- */
        #portfolio-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            /* Allow scrolling for the sand part later */
            overflow-y: auto; 
            perspective: 1200px; /* Crucial for the 3D tilt */
            background: radial-gradient(circle at center, #111 0%, #000 100%);
        }

        .ice-stage {
            height: 100vh;
            width: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            transform-style: preserve-3d;
        }

        .ice-slab {
            width: 70vw;
            height: 60vh;
            background: linear-gradient(135deg, rgba(165, 216, 255, 0.05), rgba(165, 216, 255, 0.01));
            border: 1px solid rgba(165, 216, 255, 0.3);
            border-radius: 15px;
            
            /* The 3D Angle */
            transform: rotateX(45deg) rotateZ(0deg); 
            transform-style: preserve-3d; /* Allows children to float off surface */
            
            box-shadow: 
                0 20px 50px rgba(0,0,0,1),
                inset 0 0 40px rgba(165, 216, 255, 0.1);
            position: relative;
        }

        /* Fake thickness for the slab */
        .ice-slab::before {
            content: '';
            position: absolute;
            top: 100%; left: 0; width: 100%; height: 20px;
            background: rgba(165, 216, 255, 0.1);
            transform-origin: top;
            transform: rotateX(-90deg);
            border-bottom: 1px solid rgba(165, 216, 255, 0.2);
        }

        #frost-canvas {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            mix-blend-mode: overlay;
            border-radius: 15px;
        }

        .ice-content {
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%) translateZ(60px); /* Lifts text OFF the ice to prevent clipping */
            text-align: center;
            pointer-events: none;
        }

        .ice-content h1 {
            font-size: 5vw;
            font-family: 'Playfair Display', serif;
            background: linear-gradient(to bottom, #fff, #a5d8ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            filter: drop-shadow(0 0 10px rgba(165, 216, 255, 0.5));
        }

        .ice-content p {
            font-size: 1.2rem;
            color: rgba(255,255,255,0.7);
            margin-top: 10px;
        }

        /* --- PROJECTS (THREE.JS WHISKEY) --- */
        #projects-section {
            background: #000;
            overflow: hidden;
        }

        #webgl-container {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1;
        }

        .project-ui {
            position: absolute;
            z-index: 2;
            width: 100%;
            height: 100%;
            pointer-events: none; /* Let clicks pass to 3D canvas */
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10%;
        }

        .project-card {
            background: rgba(20, 20, 20, 0.6);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 2rem;
            border-radius: 12px;
            backdrop-filter: blur(8px);
            width: 300px;
            color: #ccc;
            transform: translateY(20px);
            opacity: 0;
            transition: all 0.5s ease;
        }
        
        .project-card.visible {
            transform: translateY(0);
            opacity: 1;
        }

        .project-card h3 {
            color: #d48c26;
            font-family: 'Playfair Display', serif;
            font-size: 1.5rem;
            margin-bottom: 10px;
        }

    </style>
</head>
<body>

    <nav>
        <button class="nav-btn active" onclick="setTab('portfolio')">Portfolio</button>
        <button class="nav-btn" onclick="setTab('projects')">Projects</button>
    </nav>

    <section id="portfolio-section" class="section-container active">
        <div class="ice-stage">
            <div class="ice-slab">
                <canvas id="frost-canvas"></canvas>
                <div class="ice-content">
                    <h1>JOHN DOE</h1>
                    <p>Creative Developer</p>
                </div>
            </div>
        </div>
        </section>

    <section id="projects-section" class="section-container">
        <div id="webgl-container"></div>
        <div class="project-ui">
            <div class="project-card visible" id="card-left">
                <h3>Trading Bot</h3>
                <p>High-frequency Python algorithm visualization.</p>
            </div>
            <div class="project-card visible" id="card-right">
                <h3>Neural Art</h3>
                <p>Generative AI image processor using WebGL.</p>
            </div>
        </div>
    </section>

    <script>
        // --- 1. TAB SWITCHING SYSTEM ---
        let currentTab = 'portfolio';
        
        function setTab(tab) {
            currentTab = tab;
            
            // UI Toggle
            document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.querySelectorAll('.section-container').forEach(sec => sec.classList.remove('active'));
            
            if(tab === 'portfolio') {
                document.getElementById('portfolio-section').classList.add('active');
            } else {
                document.getElementById('projects-section').classList.add('active');
                initThreeJS(); // Start 3D only when needed
            }
        }

        // --- 2. ICE FROST EFFECT (CANVAS) ---
        const canvas = document.getElementById('frost-canvas');
        const ctx = canvas.getContext('2d');
        let particles = [];

        function resizeCanvas() {
            const rect = canvas.parentElement.getBoundingClientRect();
            canvas.width = rect.width;
            canvas.height = rect.height;
        }
        window.addEventListener('resize', resizeCanvas);
        setTimeout(resizeCanvas, 100); // Init

        // Add Frost on Move
        canvas.parentElement.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            const x = e.clientX - rect.left;
            const y = e.clientY - rect.top;
            
            // Create a cluster of "frost" particles
            for(let i=0; i<3; i++) {
                particles.push({
                    x: x + (Math.random() - 0.5) * 20,
                    y: y + (Math.random() - 0.5) * 20,
                    size: Math.random() * 20 + 5,
                    life: 1.0
                });
            }
        });

        function animateFrost() {
            if(currentTab !== 'portfolio') {
                requestAnimationFrame(animateFrost);
                return;
            }

            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // Draw particles
            particles.forEach((p, index) => {
                p.life -= 0.01;
                if(p.life <= 0) particles.splice(index, 1);
                
                ctx.beginPath();
                ctx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
                const grad = ctx.createRadialGradient(p.x, p.y, 0, p.x, p.y, p.size);
                grad.addColorStop(0, `rgba(255, 255, 255, ${p.life * 0.4})`);
                grad.addColorStop(1, `rgba(255, 255, 255, 0)`);
                ctx.fillStyle = grad;
                ctx.fill();
            });
            requestAnimationFrame(animateFrost);
        }
        animateFrost();


        // --- 3. THREE.JS WHISKEY GLASS (THE REAL 3D STUFF) ---
        let scene, camera, renderer, glassGroup;
        let liquidMesh, glassMesh;
        let mouseX = 0, mouseY = 0;
        let targetRotationX = 0, targetRotationY = 0;
        let isThreeInit = false;

        function initThreeJS() {
            if(isThreeInit) return;
            isThreeInit = true;

            const container = document.getElementById('webgl-container');

            // SCENE
            scene = new THREE.Scene();
            scene.fog = new THREE.FogExp2(0x050505, 0.05);

            // CAMERA
            camera = new THREE.PerspectiveCamera(45, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.set(0, 2, 8);
            camera.lookAt(0, 0, 0);

            // RENDERER
            renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            renderer.toneMapping = THREE.ACESFilmicToneMapping;
            renderer.outputEncoding = THREE.sRGBEncoding;
            container.appendChild(renderer.domElement);

            // LIGHTS
            const ambientLight = new THREE.AmbientLight(0xffffff, 0.2);
            scene.add(ambientLight);

            const spotLight = new THREE.SpotLight(0xffa95c, 5); // Warm whiskey light
            spotLight.position.set(5, 10, 5);
            spotLight.castShadow = true;
            spotLight.penumbra = 0.5;
            scene.add(spotLight);
            
            const blueRimLight = new THREE.PointLight(0x4455ff, 2);
            blueRimLight.position.set(-5, 2, -5);
            scene.add(blueRimLight);

            // MATERIALS
            const glassMaterial = new THREE.MeshPhysicalMaterial({
                color: 0xffffff,
                metalness: 0,
                roughness: 0,
                transmission: 1, // Glass-like transparency
                thickness: 0.5,
                ior: 1.5, // Index of Refraction
                transparent: true,
                opacity: 1
            });

            const liquidMaterial = new THREE.MeshPhysicalMaterial({
                color: 0xd48c26, // Whiskey Color
                metalness: 0.1,
                roughness: 0.1,
                transmission: 0.4,
                transparent: true,
                opacity: 0.9,
                ior: 1.4
            });

            const iceMaterial = new THREE.MeshPhysicalMaterial({
                color: 0xffffff,
                roughness: 0.2,
                transmission: 0.8,
                thickness: 1.0,
                clearcoat: 1.0
            });

            // GEOMETRY GROUP
            glassGroup = new THREE.Group();
            scene.add(glassGroup);

            // 1. The Glass Cup
            const cupGeo = new THREE.CylinderGeometry(1.5, 1.4, 3, 32);
            // Create a hollow cup effect by slight scaling logic isn't native, so we rely on transparency
            glassMesh = new THREE.Mesh(cupGeo, glassMaterial);
            glassMesh.position.y = 0;
            glassMesh.castShadow = true;
            glassGroup.add(glassMesh);

            // 2. The Liquid (Slightly smaller cylinder inside)
            const liqGeo = new THREE.CylinderGeometry(1.35, 1.25, 1.8, 32);
            liqGeo.translate(0, -0.5, 0); // Shift center of mass down so it rotates from bottom
            liquidMesh = new THREE.Mesh(liqGeo, liquidMaterial);
            liquidMesh.position.y = 0;
            glassGroup.add(liquidMesh);

            // 3. Ice Cubes
            const cubeGeo = new THREE.BoxGeometry(0.8, 0.8, 0.8);
            
            const cube1 = new THREE.Mesh(cubeGeo, iceMaterial);
            cube1.position.set(0.2, -0.2, 0.2);
            cube1.rotation.set(Math.random(), Math.random(), Math.random());
            glassGroup.add(cube1);

            const cube2 = new THREE.Mesh(cubeGeo, iceMaterial);
            cube2.position.set(-0.3, 0.4, -0.1);
            cube2.rotation.set(Math.random(), Math.random(), Math.random());
            glassGroup.add(cube2);


            // MOUSE INTERACTION
            document.addEventListener('mousemove', (e) => {
                if(currentTab !== 'projects') return;
                // Normalize mouse -1 to 1
                mouseX = (e.clientX / window.innerWidth) * 2 - 1;
                mouseY = -(e.clientY / window.innerHeight) * 2 + 1;
            });

            animateThree();
        }

        function animateThree() {
            if(currentTab !== 'projects') return;
            requestAnimationFrame(animateThree);

            // Smooth damping for Glass Tilt
            targetRotationY += (mouseX * 0.5 - targetRotationY) * 0.05;
            targetRotationX += (mouseY * 0.2 - targetRotationX) * 0.05;

            // Apply rotation to the whole group (Glass)
            glassGroup.rotation.y = targetRotationY;
            glassGroup.rotation.x = targetRotationX;

            // LIQUID PHYSICS SIMULATION
            // The liquid lags behind the glass to simulate inertia (sloshing)
            liquidMesh.rotation.x = -targetRotationX * 0.5 + Math.sin(Date.now() * 0.003) * 0.05;
            liquidMesh.rotation.z = targetRotationY * 0.5 + Math.cos(Date.now() * 0.002) * 0.05;

            // Parallax float for the whole scene
            camera.position.x += (mouseX * 0.5 - camera.position.x) * 0.02;
            camera.position.y += (2 + mouseY * 0.2 - camera.position.y) * 0.02;
            camera.lookAt(0, 0, 0);

            renderer.render(scene, camera);
        }
        
        // Handle Resize
        window.addEventListener('resize', () => {
            if(camera && renderer) {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }
        });

    </script>
</body>
</html>
