<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ice & Ember Portfolio Ultimate</title>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@300;500&display=swap');

        :root {
            --bg-dark: #050505;
            --accent: #d48c26;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            background-color: var(--bg-dark);
            color: white;
            font-family: 'Montserrat', sans-serif;
            overflow: hidden; 
            height: 100vh;
            width: 100vw;
        }

        /* --- NAVIGATION --- */
        nav {
            position: fixed;
            top: 30px; left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            display: flex;
            gap: 10px;
            background: rgba(20,20,20,0.8);
            padding: 8px 10px;
            border-radius: 50px;
            border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px);
        }

        .nav-btn {
            background: none;
            border: none;
            color: rgba(255,255,255,0.4);
            font-family: 'Montserrat', sans-serif;
            font-weight: 500;
            font-size: 0.9rem;
            padding: 10px 25px;
            border-radius: 30px;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 1, 0.5, 1);
        }

        .nav-btn.active {
            background: rgba(255,255,255,0.1);
            color: #fff;
            box-shadow: 0 0 15px rgba(255,255,255,0.05);
        }

        /* --- SECTIONS --- */
        .section {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.8s ease;
        }
        .section.active { opacity: 1; pointer-events: all; }

        /* --- PORTFOLIO: ICE SLAB (CSS 3D) --- */
        #portfolio-section {
            perspective: 1000px;
            background: radial-gradient(circle at center, #1a1a1a 0%, #000000 100%);
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .ice-stage {
            transform-style: preserve-3d;
            transform: rotateX(25deg); /* The Angle */
            position: relative;
        }

        .ice-slab {
            width: 60vw;
            height: 70vh;
            background: linear-gradient(135deg, rgba(200, 235, 255, 0.08), rgba(200, 235, 255, 0.02));
            border: 1px solid rgba(255, 255, 255, 0.15);
            border-radius: 4px;
            box-shadow: 
                0 0 30px rgba(165, 216, 255, 0.1),
                inset 0 0 100px rgba(0,0,0,0.8);
            backdrop-filter: blur(8px); /* Real blur behind */
            position: relative;
            transform-style: preserve-3d;
        }

        /* Glossy Highlight on Ice */
        .ice-slab::after {
            content: '';
            position: absolute;
            top: 0; left: 0; right: 0; bottom: 0;
            background: linear-gradient(120deg, transparent 40%, rgba(255,255,255,0.1) 50%, transparent 60%);
            background-size: 200% 100%;
            animation: shine 8s infinite linear;
            pointer-events: none;
        }

        .content-layer {
            position: absolute;
            top: 50%; left: 50%;
            /* FIX FOR CLIPPING: Lift text 100px off the slab */
            transform: translate(-50%, -50%) translateZ(80px); 
            text-align: center;
            width: 100%;
        }

        h1 {
            font-family: 'Playfair Display', serif;
            font-size: 5rem;
            margin: 0;
            background: linear-gradient(to bottom, #fff 40%, #a5d8ff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 10px 20px rgba(0,0,0,0.5);
        }

        p.subtitle {
            font-size: 1.2rem;
            letter-spacing: 2px;
            color: rgba(255,255,255,0.6);
            margin-top: 10px;
        }

        /* --- PROJECTS: 3D CANVAS --- */
        #webgl-canvas {
            position: absolute;
            top: 0; left: 0; width: 100%; height: 100%;
            z-index: 1;
        }

        .overlay-ui {
            position: absolute;
            z-index: 2;
            width: 100%; height: 100%;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 10%;
            pointer-events: none;
        }

        .card {
            background: rgba(10, 10, 10, 0.7);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 30px;
            border-radius: 12px;
            max-width: 300px;
            backdrop-filter: blur(10px);
            transform: translateY(50px);
            opacity: 0;
            transition: all 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
        }

        .section.active .card {
            transform: translateY(0);
            opacity: 1;
        }

        .card h2 {
            font-family: 'Playfair Display', serif;
            color: var(--accent);
            margin-bottom: 10px;
        }
        .card p { font-size: 0.9rem; color: #aaa; line-height: 1.5; }

        @keyframes shine { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

    </style>
</head>
<body>

    <nav>
        <button class="nav-btn active" onclick="switchTab('portfolio')">Portfolio</button>
        <button class="nav-btn" onclick="switchTab('projects')">Projects</button>
    </nav>

    <section id="portfolio-section" class="section active">
        <div class="ice-stage" id="ice-stage">
            <div class="ice-slab">
                <canvas id="frost-canvas" style="position:absolute; width:100%; height:100%; top:0; left:0; mix-blend-mode: overlay; opacity: 0.7;"></canvas>
                
                <div class="content-layer">
                    <h1>JOHN DOE</h1>
                    <p class="subtitle">CREATIVE DEVELOPER</p>
                </div>
            </div>
        </div>
    </section>

    <section id="projects-section" class="section">
        <canvas id="webgl-canvas"></canvas>
        <div class="overlay-ui">
            <div class="card" style="transition-delay: 0.1s">
                <h2>Alpha Trade</h2>
                <p>Algorithmic trading platform utilizing Python and WebSockets for real-time data visualization.</p>
            </div>
            <div class="card" style="transition-delay: 0.3s">
                <h2>Neuro Vision</h2>
                <p>Medical imaging AI that detects anomalies in X-rays with 99% accuracy using TensorFlow.</p>
            </div>
        </div>
    </section>

    <script type="module">
        import * as THREE from 'three';
        import { RoomEnvironment } from 'three/addons/environments/RoomEnvironment.js';

        // --- GLOBAL VARIABLES ---
        let currentTab = 'portfolio';
        
        // --- 1. PORTFOLIO ICE INTERACTIVITY (Vanilla JS) ---
        const iceStage = document.getElementById('ice-stage');
        document.getElementById('portfolio-section').addEventListener('mousemove', (e) => {
            if(currentTab !== 'portfolio') return;
            // Subtle parallax tilt of the slab
            const x = (window.innerWidth / 2 - e.clientX) / 40;
            const y = (window.innerHeight / 2 - e.clientY) / 40;
            // Maintain the base 25deg rotation and add mouse influence
            iceStage.style.transform = `rotateX(${25 + y}deg) rotateY(${x}deg)`;
        });

        // Frost Canvas Logic
        const frostC = document.getElementById('frost-canvas');
        const fCtx = frostC.getContext('2d');
        
        function resizeFrost() {
            const rect = frostC.getBoundingClientRect();
            frostC.width = rect.width;
            frostC.height = rect.height;
        }
        window.addEventListener('resize', resizeFrost);
        setTimeout(resizeFrost, 100);

        let trails = [];
        frostC.addEventListener('mousemove', (e) => {
            const rect = frostC.getBoundingClientRect();
            trails.push({ x: e.clientX - rect.left, y: e.clientY - rect.top, age: 0 });
        });

        function animateFrost() {
            fCtx.clearRect(0,0, frostC.width, frostC.height);
            fCtx.fillStyle = 'rgba(255,255,255,0.1)'; 
            trails.forEach((t, i) => {
                t.age++;
                fCtx.beginPath();
                fCtx.arc(t.x, t.y, 20 - t.age*0.2, 0, Math.PI*2);
                fCtx.fill();
            });
            trails = trails.filter(t => t.age < 100);
            requestAnimationFrame(animateFrost);
        }
        animateFrost();


        // --- 2. PROJECTS 3D WHISKEY (Three.js) ---
        
        // Scene Setup
        const canvas = document.querySelector('#webgl-canvas');
        const renderer = new THREE.WebGLRenderer({ canvas, alpha: true, antialias: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.0;

        const scene = new THREE.Scene();

        // **CRITICAL**: Environment Map (Make glass look real)
        const pmremGenerator = new THREE.PMREMGenerator(renderer);
        scene.environment = pmremGenerator.fromScene(new RoomEnvironment(), 0.04).texture;

        const camera = new THREE.PerspectiveCamera(35, window.innerWidth/window.innerHeight, 0.1, 100);
        camera.position.set(0, 3, 12);

        // Group to rotate everything
        const glassGroup = new THREE.Group();
        scene.add(glassGroup);

        // Materials
        const glassMaterial = new THREE.MeshPhysicalMaterial({
            color: 0xffffff,
            transmission: 1.0,  // Full glass transparency
            opacity: 1.0,
            metalness: 0.0,
            roughness: 0.05,    // Very smooth
            ior: 1.5,           // Refraction index of glass
            thickness: 0.5,     // Volume rendering
            specularIntensity: 1.0,
            clearcoat: 1.0
        });

        const liquidMaterial = new THREE.MeshPhysicalMaterial({
            color: 0xffa500,    // Whiskey Amber
            transmission: 0.6,
            opacity: 0.9,
            metalness: 0.0,
            roughness: 0.2,
            ior: 1.4,
            attenuationColor: new THREE.Color(0x8a4b08), // Darkens as light goes through
            attenuationDistance: 2.0
        });

        const iceMaterial = new THREE.MeshPhysicalMaterial({
            color: 0xffffff,
            transmission: 0.9,
            roughness: 0.2,
            thickness: 1.5,
            clearcoat: 1.0,
            ior: 1.31
        });

        // 1. CREATE THE GLASS CUP (Using LatheGeometry for thickness)
        // We draw the "profile" of the cup wall
        const points = [];
        for ( let i = 0; i < 10; i ++ ) {
            // Inner wall (bottom up)
            points.push( new THREE.Vector2( Math.sin( i * 0.2 ) * 1.3 + 0.1, ( i - 5 ) * 0.5 ) ); 
        }
        // Manual simple shape:
        const profile = [
            new THREE.Vector2(0, 0),       // Center Bottom
            new THREE.Vector2(1.5, 0),     // Outer Bottom Edge
            new THREE.Vector2(1.8, 4),     // Outer Top Rim
            new THREE.Vector2(1.6, 4),     // Inner Top Rim
            new THREE.Vector2(1.35, 0.4),  // Inner Bottom Edge
            new THREE.Vector2(0, 0.4)      // Inner Center
        ];
        const geometry = new THREE.LatheGeometry( profile, 40 ); 
        const cup = new THREE.Mesh( geometry, glassMaterial );
        cup.position.y = -2;
        cup.castShadow = true;
        glassGroup.add( cup );

        // 2. CREATE THE LIQUID
        // Just a simple cylinder inside the cup
        const liqGeo = new THREE.CylinderGeometry(1.55, 1.2, 2.0, 32);
        const liquid = new THREE.Mesh(liqGeo, liquidMaterial);
        liquid.position.y = -0.8;
        glassGroup.add(liquid);

        // 3. ICE CUBES
        const cubeGeo = new THREE.BoxGeometry(0.9, 0.9, 0.9);
        
        const cube1 = new THREE.Mesh(cubeGeo, iceMaterial);
        cube1.position.set(0.3, -0.5, 0.3);
        cube1.rotation.set(0.5, 0.5, 0);
        glassGroup.add(cube1);

        const cube2 = new THREE.Mesh(cubeGeo, iceMaterial);
        cube2.position.set(-0.4, 0.2, -0.2);
        cube2.rotation.set(0.8, 0.2, 0.4);
        glassGroup.add(cube2);

        // Lighting
        const spotLight = new THREE.SpotLight( 0xffffff, 100 );
        spotLight.position.set( 5, 10, 5 );
        spotLight.angle = Math.PI / 6;
        spotLight.penumbra = 1;
        scene.add( spotLight );

        const rimLight = new THREE.PointLight( 0x4488ff, 20 );
        rimLight.position.set( -5, 2, -5 );
        scene.add( rimLight );


        // Animation Variables
        let mouseX = 0;
        let mouseY = 0;
        let targetRotX = 0;
        let targetRotY = 0;

        document.addEventListener('mousemove', (e) => {
            mouseX = (e.clientX - window.innerWidth / 2) * 0.001;
            mouseY = (e.clientY - window.innerHeight / 2) * 0.001;
        });

        // Loop
        function animate() {
            requestAnimationFrame(animate);

            if (currentTab === 'projects') {
                // Smooth Camera movement
                targetRotX += (mouseY - targetRotX) * 0.05;
                targetRotY += (mouseX - targetRotY) * 0.05;

                // Rotate the whole glass group
                glassGroup.rotation.x = targetRotX * 0.5;
                glassGroup.rotation.y = targetRotY * 1.5;

                // Liquid Slosh Physics (Lag behind the glass)
                liquid.rotation.x = -targetRotX * 0.8 + Math.sin(Date.now()*0.002)*0.05;
                liquid.rotation.z = targetRotY * 0.8 + Math.cos(Date.now()*0.003)*0.05;
                
                // Ice float animation
                cube2.position.y = 0.2 + Math.sin(Date.now() * 0.001) * 0.05;
                cube2.rotation.y += 0.002;

                renderer.render(scene, camera);
            }
        }
        animate();


        // --- UI LOGIC ---
        window.switchTab = function(tabName) {
            currentTab = tabName;
            
            // Buttons
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
            
            // Sections
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(tabName + '-section').classList.add('active');
        };

        // Resize
        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
            resizeFrost();
        });

    </script>
</body>
</html>
