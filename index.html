<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ice & Ember: Organic Fluid</title>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    <style>
        /* --- STYLES --- */
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Montserrat:wght@300;600&display=swap');
        
        :root { --accent: #ffae00; --bg: #050505; }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body { 
            background-color: var(--bg); 
            color: white; 
            font-family: 'Montserrat', sans-serif; 
            overflow: hidden; 
            height: 100vh; width: 100vw;
        }

        nav {
            position: fixed; top: 40px; left: 50%; transform: translateX(-50%);
            z-index: 100; display: flex; gap: 20px;
            background: rgba(10,10,10,0.8); padding: 12px 30px; border-radius: 100px;
            border: 1px solid rgba(255,255,255,0.15); backdrop-filter: blur(20px);
        }
        .nav-btn {
            background: transparent; border: none; color: rgba(255,255,255,0.5);
            font-size: 1rem; font-weight: 600; cursor: pointer; transition: 0.3s;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .nav-btn.active { color: white; text-shadow: 0 0 10px rgba(255,255,255,0.5); }

        .section {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            opacity: 0; pointer-events: none; transition: opacity 1s ease;
        }
        .section.active { opacity: 1; pointer-events: all; }

        /* PORTFOLIO */
        #portfolio-section { display: flex; justify-content: center; align-items: center; perspective: 1000px; }
        .ice-slab {
            width: 70vw; height: 60vh;
            background: linear-gradient(135deg, rgba(255,255,255,0.05), rgba(255,255,255,0.01));
            border: 1px solid rgba(255,255,255,0.1); border-radius: 12px;
            transform: rotateX(20deg); box-shadow: 0 50px 100px black;
            display: flex; justify-content: center; align-items: center;
            position: relative;
        }
        .ice-text { text-align: center; }
        h1 { font-family: 'Playfair Display'; font-size: 4rem; margin-bottom: 10px; }
        
        /* PROJECTS */
        #webgl-canvas { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }
        
        .ui-layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            display: flex; justify-content: space-between; align-items: center;
            padding: 0 10%; pointer-events: none;
        }
        .card {
            width: 280px; padding: 40px 30px;
            background: rgba(5,5,5,0.85); border-left: 4px solid var(--accent);
            backdrop-filter: blur(10px); color: #ddd;
            opacity: 0; transform: translateY(50px); transition: 0.8s cubic-bezier(0.2, 0.8, 0.2, 1);
        }
        .section.active .card { opacity: 1; transform: translateY(0); }
        .card h3 { color: var(--accent); font-family: 'Playfair Display'; margin-bottom: 10px; font-size: 1.5rem; }
        .card p { font-size: 0.85rem; line-height: 1.6; color: #aaa; }

    </style>
</head>
<body>

    <nav>
        <button class="nav-btn active" onclick="setTab('portfolio')">Portfolio</button>
        <button class="nav-btn" onclick="setTab('projects')">Projects</button>
    </nav>

    <section id="portfolio-section" class="section active">
        <div class="ice-slab">
            <canvas id="frost-canvas" style="position: absolute; top:0; left:0; width:100%; height:100%; opacity: 0.4; mix-blend-mode: overlay;"></canvas>
            <div class="ice-text">
                <h1>THE FROST</h1>
                <p style="letter-spacing: 5px; opacity: 0.7;">DIGITAL DESIGN</p>
            </div>
        </div>
    </section>

    <section id="projects-section" class="section">
        <canvas id="webgl-canvas"></canvas>
        <div class="ui-layer">
            <div class="card" id="card-left">
                <h3>VINTAGE UI</h3>
                <p>Interfaces that feel physical. Tactile depth, realistic lighting, and glassmorphism.</p>
            </div>
            <div class="card" id="card-right">
                <h3>FLUID ENGINE</h3>
                <p>Organic liquid simulation using multi-layered noise algorithms for natural movement.</p>
            </div>
        </div>
    </section>

    <script type="module">
        import * as THREE from 'three';
        import { RGBELoader } from 'three/addons/loaders/RGBELoader.js';

        let currentTab = 'portfolio';
        let mouse = { x: 0, y: 0 };
        const windowHalfX = window.innerWidth / 2;
        const windowHalfY = window.innerHeight / 2;

        // --- 1. FROST CANVAS (2D) ---
        const fC = document.getElementById('frost-canvas');
        const fX = fC.getContext('2d');
        let trails = [];
        const resizeFrost = () => { fC.width = fC.offsetWidth; fC.height = fC.offsetHeight; };
        window.addEventListener('resize', resizeFrost); resizeFrost();

        document.addEventListener('mousemove', (e) => {
            mouse.x = (e.clientX - windowHalfX) / windowHalfX;
            mouse.y = (e.clientY - windowHalfY) / windowHalfY;
            
            if(currentTab === 'portfolio') {
                const r = fC.getBoundingClientRect();
                trails.push({ x: e.clientX - r.left, y: e.clientY - r.top, a: 0.5 });
            }
        });

        function renderIce() {
            fX.clearRect(0,0, fC.width, fC.height);
            trails.forEach(t => {
                t.a -= 0.01; fX.beginPath(); fX.arc(t.x, t.y, 30, 0, 7);
                fX.fillStyle = `rgba(255,255,255,${t.a})`; fX.fill();
            });
            trails = trails.filter(t => t.a > 0);
            requestAnimationFrame(renderIce);
        }
        renderIce();


        // --- 2. 3D ENGINE ---
        const canvas = document.querySelector('#webgl-canvas');
        const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.setPixelRatio(Math.min(window.devicePixelRatio, 2));
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.5; // Brightness boost

        const scene = new THREE.Scene();

        // HDRI Environment
        new RGBELoader()
            .setPath('https://dl.polyhaven.org/file/ph-assets/HDRIs/hdr/1k/')
            .load('studio_small_09_1k.hdr', function (texture) {
                texture.mapping = THREE.EquirectangularReflectionMapping;
                scene.environment = texture;
            });

        const camera = new THREE.PerspectiveCamera(40, window.innerWidth/window.innerHeight, 0.1, 100);
        camera.position.set(0, 4, 14);

        const glassGroup = new THREE.Group();
        glassGroup.position.y = -2.5; 
        scene.add(glassGroup);

        // --- MATERIALS ---
        
        // FIX: Pure White Glass (removes "Metal" look)
        const glassMat = new THREE.MeshPhysicalMaterial({
            color: 0xffffff,    // Pure white for clarity
            transmission: 1.0,  
            thickness: 0.1,     // Thin walls
            roughness: 0,       // Perfectly smooth
            ior: 1.5,
            clearcoat: 1.0,
            transparent: true,
            side: THREE.FrontSide 
        });

        const liquidMat = new THREE.MeshPhysicalMaterial({
            color: 0xffaa00,
            transmission: 0.6, 
            thickness: 1.5,    
            roughness: 0.2,
            ior: 1.33,
            attenuationColor: new THREE.Color(0x8a4b08), 
            attenuationDistance: 3.0, // See deeper into the liquid
            transparent: true
        });

        const iceMat = new THREE.MeshPhysicalMaterial({
            transmission: 0.9, roughness: 0.3, thickness: 1.5, ior: 1.31,
            color: 0xffffff, clearcoat: 0.5
        });

        // --- GEOMETRY ---

        const cupProfile = [
            new THREE.Vector2(0, 0),    
            new THREE.Vector2(3, 0),    
            new THREE.Vector2(3.2, 5),  
            new THREE.Vector2(3.0, 5),  
            new THREE.Vector2(2.8, 0.5),
            new THREE.Vector2(0, 0.5)   
        ];
        const cupGeo = new THREE.LatheGeometry(cupProfile, 64);
        const cup = new THREE.Mesh(cupGeo, glassMat);
        cup.renderOrder = 2; // Glass renders last
        glassGroup.add(cup);

        // --- NEW FLUID METHOD: High-Res Mesh + Noise Math ---
        // Instead of Radial Segments, we use a high-poly cylinder and distort vertices
        // using superimposed sine waves (Pseudo-Perlin).
        const liquidGeo = new THREE.CylinderGeometry(2.9, 2.7, 2.5, 128, 32); // High resolution
        const liquid = new THREE.Mesh(liquidGeo, liquidMat);
        liquid.position.y = 1.8; 
        liquid.renderOrder = 1; // Liquid renders first
        glassGroup.add(liquid);

        const iceGeo = new THREE.BoxGeometry(1.6, 1.6, 1.6);
        const iceCube = new THREE.Mesh(iceGeo, iceMat);
        iceCube.position.set(0, 1.5, 0);
        iceCube.rotation.set(0.5, 0.5, 0);
        glassGroup.add(iceCube);

        // --- LIGHTING ---
        const backLight = new THREE.PointLight(0xffffff, 80);
        backLight.position.set(0, 5, -10);
        scene.add(backLight);

        const fillLight = new THREE.DirectionalLight(0xffaa00, 3);
        fillLight.position.set(-5, 5, 5);
        scene.add(fillLight);

        const cardL = document.getElementById('card-left');
        const cardR = document.getElementById('card-right');

        // Simple pseudo-noise function
        function noise(x, z, t) {
            return Math.sin(x * 0.8 + t) * Math.cos(z * 0.8 + t) + 
                   Math.sin(x * 2.5 + t * 2) * 0.1 + 
                   Math.cos(z * 3.0 + t * 1.5) * 0.1; 
        }

        function animate() {
            requestAnimationFrame(animate);

            if(currentTab === 'projects') {
                glassGroup.rotation.y += (mouse.x * 0.5 - glassGroup.rotation.y) * 0.05;
                glassGroup.rotation.x += (mouse.y * 0.2 - glassGroup.rotation.x) * 0.05;

                // --- ORGANIC FLUID SIMULATION ---
                const time = Date.now() * 0.002;
                const pos = liquidGeo.attributes.position;
                
                for(let i=0; i<pos.count; i++){
                    // Only animate top surface (y > 1.0)
                    if(pos.getY(i) > 1.0) {
                        const x = pos.getX(i);
                        const z = pos.getZ(i);
                        
                        // Use "Noise" function instead of simple sine waves
                        const organicWave = noise(x, z, time) * 0.2;
                        
                        // Slosh logic (Mouse influence)
                        const slosh = (x * mouse.x * 0.4) + (z * -mouse.y * 0.2);

                        // Base height + Wave + Slosh
                        pos.setY(i, 1.25 + organicWave + slosh);
                    }
                }
                pos.needsUpdate = true;
                liquidGeo.computeVertexNormals(); 

                iceCube.rotation.y += 0.005;
                iceCube.position.y = 1.5 + Math.sin(time * 0.5) * 0.1;

                cardL.style.transform = `translate(${mouse.x * -40}px, ${mouse.y * -20}px)`;
                cardR.style.transform = `translate(${mouse.x * -60}px, ${mouse.y * -30}px)`;

                renderer.render(scene, camera);
            }
        }
        animate();


        // --- UI LOGIC ---
        window.setTab = (t) => {
            currentTab = t;
            document.querySelectorAll('.section').forEach(s => s.classList.remove('active'));
            document.getElementById(t + '-section').classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            event.target.classList.add('active');
        };

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });
    </script>
</body>
</html>
