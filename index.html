<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ice & Ember: Clean</title>
    <script type="importmap">
        {
            "imports": {
                "three": "https://unpkg.com/three@0.160.0/build/three.module.js",
                "three/addons/": "https://unpkg.com/three@0.160.0/examples/jsm/"
            }
        }
    </script>
    <style>
        /* --- CLEAN TYPOGRAPHY & LAYOUT --- */
        @import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@600&family=Inter:wght@300;500&display=swap');
        
        body { margin: 0; overflow: hidden; background: #050505; font-family: 'Inter', sans-serif; }
        
        nav {
            position: fixed; top: 30px; left: 50%; transform: translateX(-50%); z-index: 10;
            display: flex; gap: 20px; background: rgba(20,20,20,0.8); 
            padding: 10px 30px; border-radius: 50px; border: 1px solid rgba(255,255,255,0.1);
        }
        button {
            background: none; border: none; color: #888; cursor: pointer; font-size: 1rem; transition: 0.3s;
        }
        button.active { color: white; }

        .layer {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            pointer-events: none; opacity: 0; transition: opacity 0.5s;
        }
        .layer.active { opacity: 1; pointer-events: all; }

        /* TAB 1: ICE */
        #ice-layer { display: flex; justify-content: center; align-items: center; }
        .ice-card {
            width: 600px; height: 400px;
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            backdrop-filter: blur(10px); transform: rotateX(20deg);
            display: flex; justify-content: center; align-items: center; color: #a5d8ff;
        }
        
        /* TAB 2: WHISKEY UI */
        #project-layer { padding: 50px; display: flex; justify-content: space-between; align-items: center; }
        .info-card {
            width: 250px; color: #ccc; transform: translateY(20px); transition: 0.5s;
        }
        .layer.active .info-card { transform: translateY(0); }
        h2 { font-family: 'Playfair Display', serif; color: #d48c26; margin-bottom: 10px; }

        canvas { display: block; width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: -1; }
    </style>
</head>
<body>

    <nav>
        <button class="active" onclick="setTab(0)">Portfolio</button>
        <button onclick="setTab(1)">Projects</button>
    </nav>

    <div id="ice-layer" class="layer active">
        <div class="ice-card">
            <h1>THE FROST</h1>
        </div>
    </div>

    <div id="project-layer" class="layer">
        <div class="info-card" id="left-card">
            <h2>Vintage UI</h2>
            <p>Crafting digital interfaces with tactile depth.</p>
        </div>
        <div class="info-card" id="right-card" style="text-align: right;">
            <h2>Fluid Logic</h2>
            <p>Physics-based interaction models.</p>
        </div>
    </div>

    <canvas id="gl"></canvas>

    <script type="module">
        import * as THREE from 'three';
        import { RoomEnvironment } from 'three/addons/environments/RoomEnvironment.js';

        let tab = 0;
        const mouse = { x: 0, y: 0 };
        const targetRot = { x: 0, y: 0 };

        // 1. SETUP
        const canvas = document.querySelector('#gl');
        const renderer = new THREE.WebGLRenderer({ canvas, antialias: true, alpha: true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.toneMapping = THREE.ACESFilmicToneMapping;
        renderer.toneMappingExposure = 1.2;

        const scene = new THREE.Scene();
        const camera = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 0.1, 100);
        camera.position.set(0, 2, 12);

        // 2. LIGHTING (Studio Setup)
        const pmrem = new THREE.PMREMGenerator(renderer);
        scene.environment = pmrem.fromScene(new RoomEnvironment(), 0.04).texture;
        
        const spot = new THREE.SpotLight(0xffffff, 20);
        spot.position.set(5, 10, 5);
        scene.add(spot);
        
        // Backlight makes liquid glow!
        const backLight = new THREE.PointLight(0xffaa00, 10);
        backLight.position.set(0, 2, -5);
        scene.add(backLight);

        // 3. OBJECTS
        const glassGroup = new THREE.Group();
        glassGroup.position.y = -2;
        scene.add(glassGroup);

        // A. THE GLASS
        const glassMat = new THREE.MeshPhysicalMaterial({
            transmission: 1, thickness: 0.5, roughness: 0, ior: 1.5,
            color: 0xffffff, transparent: true, side: THREE.DoubleSide
        });
        
        // Simple, clean cylinder geometry
        const cupGeo = new THREE.CylinderGeometry(2.5, 2.5, 3.5, 64, 1, true);
        const cup = new THREE.Mesh(cupGeo, glassMat);
        glassGroup.add(cup);

        // The solid bottom of the glass
        const bottomGeo = new THREE.CylinderGeometry(2.5, 2.5, 0.5, 64);
        const bottom = new THREE.Mesh(bottomGeo, glassMat);
        bottom.position.y = -1.75;
        glassGroup.add(bottom);

        // B. THE WHISKEY
        const liquidMat = new THREE.MeshPhysicalMaterial({
            color: 0xff8800, transmission: 0.6, roughness: 0.1, ior: 1.4,
            attenuationColor: new THREE.Color(0x552200), attenuationDistance: 2,
            transparent: true
        });

        // Use more segments for the wave effect
        const liquidGeo = new THREE.CylinderGeometry(2.4, 2.4, 2.0, 64, 32); 
        const liquid = new THREE.Mesh(liquidGeo, liquidMat);
        liquid.position.y = -0.5;
        glassGroup.add(liquid);

        // C. THE ICE
        const iceMat = new THREE.MeshPhysicalMaterial({
            transmission: 0.9, roughness: 0.3, thickness: 1.5,
            color: 0xffffff, ior: 1.31
        });
        const ice = new THREE.Mesh(new THREE.BoxGeometry(1.5, 1.5, 1.5), iceMat);
        ice.position.y = 0;
        ice.rotation.set(0.5, 0.5, 0);
        glassGroup.add(ice);


        // 4. ANIMATION LOOP
        window.addEventListener('mousemove', e => {
            mouse.x = (e.clientX / window.innerWidth) * 2 - 1;
            mouse.y = -(e.clientY / window.innerHeight) * 2 + 1;
        });

        const liquidPos = liquidGeo.attributes.position;
        const initialY = [];
        for(let i=0; i<liquidPos.count; i++) initialY.push(liquidPos.getY(i));

        function animate() {
            requestAnimationFrame(animate);

            if (tab === 1) { // Projects Tab
                // Smooth Rotation
                targetRot.x += (mouse.y * 0.2 - targetRot.x) * 0.05;
                targetRot.y += (mouse.x * 0.5 - targetRot.y) * 0.05;
                
                glassGroup.rotation.x = targetRot.x;
                glassGroup.rotation.y = targetRot.y;

                // --- FAKE FLUID PHYSICS ---
                // Instead of simulation, we just tilt the top vertices!
                const time = Date.now() * 0.003;
                
                for(let i=0; i<liquidPos.count; i++){
                    const x = liquidPos.getX(i);
                    const z = liquidPos.getZ(i);
                    const y = initialY[i];

                    // Only animate top surface
                    if (y > 0.9) { 
                        // Calculate tilt based on mouse inertia
                        const tiltX = z * -targetRot.x * 1.5;
                        const tiltZ = x * targetRot.y * 1.5;
                        
                        // Subtle ripple
                        const ripple = Math.sin(x * 3 + time) * Math.cos(z * 3 + time) * 0.05;

                        liquidPos.setY(i, y + tiltX + tiltZ + ripple);
                    }
                }
                liquidPos.needsUpdate = true;
                
                // Ice bobbing
                ice.position.y = Math.sin(time) * 0.1;
                ice.rotation.y += 0.005;

                // Parallax UI
                document.getElementById('left-card').style.transform = `translate(${mouse.x * -20}px, ${mouse.y * -10}px)`;
                document.getElementById('right-card').style.transform = `translate(${mouse.x * -30}px, ${mouse.y * -15}px)`;
            }
            
            renderer.render(scene, camera);
        }
        animate();

        // 5. TAB SWITCHING
        window.setTab = (idx) => {
            tab = idx;
            document.querySelectorAll('button').forEach((b, i) => b.classList.toggle('active', i === idx));
            document.querySelectorAll('.layer').forEach((l, i) => l.classList.toggle('active', i === idx));
            
            // Camera zoom effect
            if(idx === 1) {
                glassGroup.visible = true;
                camera.position.z = 12; // Zoom in for projects
            } else {
                glassGroup.visible = false;
            }
        };
        
        // Init state
        setTab(0);

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

    </script>
</body>
</html>
